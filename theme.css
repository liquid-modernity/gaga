/* =====================  V2: CHAT FEEL & POLISH  ===================== */

/* 0) dasar: jangan biarkan halaman global ikut scroll */
html, body { height: 100%; }
body { overflow: hidden; }

/* 1) Shell & Center: satu scroll di center-wrap */
#shell{ min-height: 100dvh; }
.center{ min-width: 0; }
.center-wrap{
  display:flex; flex-direction:column;
  height:100dvh;               /* jadi scrollport utama */
  overflow:auto; overscroll-behavior-y: contain;
  scroll-behavior:smooth;
  -webkit-overflow-scrolling:touch;
  padding-bottom: calc(var(--chatbar-h) + var(--safe-b)); /* ruang utk sticky chatbar */
}

/* 2) Chatbar sticky (di scrollport yang sama) */
.chatbar{
  position: sticky; bottom: 0;
  z-index: 5;
  backdrop-filter: none;
}

/* 3) SmartScroll tombol mengambang di atas chatbar */
#smartScroll{
  position: sticky;
  bottom: calc(var(--chatbar-h) + 12px);
  margin-left: auto;
}

/* 4) Dockbar grid lebih adaptif */
.dock{ margin-bottom: var(--sp-4); }
.dock-grid{ display:grid; gap: var(--sp-3); grid-template-columns: repeat(3, minmax(0,1fr)); }
.dock-grid > .tile{ min-height:44px; }
@media (max-width: 599px){
  .dock-grid{ grid-template-columns: 1fr; }
  /* slider full-row, nyaman jempol */
  .dock-grid > label.tile{ grid-column: 1 / -1; }
}
@media (min-width:600px) and (max-width:1023px){
  .dock-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}

/* 5) Action bar kompak di layar kecil (ikon-only) */
@media (max-width: 360px){
  .actions .iconbtn span{ display:none; }
  .actions{ gap: 8px; }
}

/* 6) Label 2-level: rapikan & responsif 320–393px */
.label-item summary{
  display:grid; grid-template-columns: auto 1fr auto auto;
  align-items:center; gap: var(--sp-2);
  min-height:44px; padding:8px 10px;
}
.label-item .label-name{ font-weight:700; }
.label-item .count{ color:var(--muted); font-size:.92em; }
.label-item .chev{ opacity:.8; margin-left: var(--sp-2); transition: transform .2s ease; }
.label-item[open] .chev{ transform: rotate(180deg); }
.label-item .acc{ display:grid; gap: var(--sp-2); padding: var(--sp-2); border-top:1px solid var(--border); }
.label-item .acc .page-item{ min-height:44px; }
@media (max-width:360px){
  .label-item .count{ display:none; }        /* padatkan di device sempit */
}

/* 7) Bubble dengan tail siku (90°) */
.bubble{ position:relative; border-radius:12px; }
.bubble[data-role="me"]::after,
.bubble[data-role="you"]::before{
  content:""; position:absolute; width:10px; height:10px; background:var(--elev);
  box-shadow: 1px 1px 0 0 var(--border);           /* garis siku */
}
.bubble[data-role="me"]::after{ right:-6px; bottom:14px; }
.bubble[data-role="you"]::before{ left:-6px;  bottom:14px; transform: scaleX(-1); }
.bubble p{ overflow-wrap:anywhere; }

/* 8) Tipografi & ritme (baca nyaman) */
.room, .postcard .meta, .readercard .body{ overflow-wrap:anywhere; }
.readercard .body{ max-width: 72ch; line-height: 1.6; }
.card,.bubble,.postcard,.readercard,.similarcard{ padding:16px; margin:12px 0; }
.meta{ display:flex; flex-wrap:wrap; gap:12px; }

/* 9) Sidebar Right — polish & usability */
#sidebarRight{ background: var(--elev); border:1px solid var(--border); border-radius:12px; }
#sidebarRight .sb-top{
  position: sticky; top:0; z-index:2;
  background: inherit; border-bottom:1px solid var(--border);
  padding: 12px 16px;
}
#sidebarRight .sb-mid{ padding: 12px 16px; overflow:auto; }
#sidebarRight .rs-pane + .rs-pane{ margin-top:16px; }
#sidebarRight .rs-pane .eyebrow{ font-size:.95em; opacity:.9; margin:0 0 8px; }
#sidebarRight ul{ padding-left: 18px; margin: 0 0 8px; }
#sidebarRight li{ margin: 2px 0; }
#sidebarRight .replybar{
  position: sticky; bottom:0; z-index:2;
  background: inherit; padding:12px 16px; border-top:1px solid var(--border);
}
#sidebarRight .input-el{ min-height:44px; }

/* 10) Anti-overflow horizontal global */
.layout, .center-wrap, .room, .dock{ min-width:0; max-width:100%; }
img, video{ max-width:100%; height:auto; display:block; }

/* 11) Tema: Glass HANYA panel konten; matikan di mobile utk performa */
@media (max-width: 599px){
  body[data-theme="glass"] .card,
  body[data-theme="glass"] .bubble,
  body[data-theme="glass"] .postcard,
  body[data-theme="glass"] .readercard,
  body[data-theme="glass"] .chatbar,
  body[data-theme="glass"] .dock{
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
    background: var(--elev) !important;
  }
}

/* 12) Tap-target & spacing konsisten */
.tile,.btn,.btn-icon,.iconbtn,.page-item{ min-height:44px; }

/* 13) (opsional) scrollbar tipis & aksesibel */
*{ scrollbar-width:thin; scrollbar-color: color-mix(in oklab,var(--text) 40%, transparent) transparent }
::-webkit-scrollbar{ width:8px; height:8px }
::-webkit-scrollbar-thumb{ background-color: color-mix(in oklab,var(--text) 40%, transparent); border-radius:8px }
@media (hover:hover){
  ::-webkit-scrollbar-thumb:hover{ background-color: color-mix(in oklab,var(--text) 60%, transparent) }
}
