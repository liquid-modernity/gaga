/* =========================================================
   GAGA THEME — v1  (kerangka final, default LIGHT)
   - 3 tema: light / dark / glass (panel-only)
   - Layout: mobile stack, medium 2 kolom (Right full-width), desktop 3 kolom
   - Anti-CLS: aspect-ratio utils
   - Komponen: postcard, readercard, bubble, dock, chatbar
   - A11y: focus ring, icon-only on small, scrollbar
   ========================================================= */

/* ---------- Guard & baseline ---------- */
*,*::before,*::after{box-sizing:border-box}
html,body{margin:0;padding:0}
[hidden]{display:none!important}
img,video{display:block;max-width:100%;height:auto}
a{text-decoration:none;color:inherit}
button,input,select{font:inherit;color:inherit}
:where(a,button,[role="button"],input):focus-visible{outline:2px solid var(--focus);outline-offset:2px;border-radius:8px}
@media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}
/* print */
@media print{.sidebar,.dock,.chatbar{display:none} body{background:#fff;color:#000}}

/* ---------- Tokens ---------- */
:root{
  /* spacing & rhythm */
  --sp-1:4px; --sp-2:8px; --sp-3:12px; --sp-4:16px; --sp-5:24px; --sp-6:32px;
  /* sizing */
  --left-w:280px; --right-w:280px; --center-max:1100px; --center-pad:16px; --chatbar-h:64px;
  /* type */
  --ts:1; --fz-base:calc(16px*var(--ts)); --lh-base:1.6; --fz-small:calc(14px*var(--ts)); --lh-small:1.5;
  /* brand / focus */
  --focus:#D81B60;
  /* default LIGHT (selaras body[data-theme="light"] di XML) */
  --bg:#FFFFFF; --elev:#F6F7F9; --text:#1B1F29; --muted:#4A5260; --border:#DCE1EA;
}
/* Light (eksplisit) */
body[data-theme="light"]{
  --bg:#FFFFFF; --elev:#F6F7F9; --text:#1B1F29; --muted:#4A5260; --border:#DCE1EA;
}
/* Dark */
body[data-theme="dark"]{
  --bg:#0B0E13; --elev:#141923; --text:#E7EAF0; --muted:#B5BAC6; --border:#2A3040;
}
/* Glass (panel-only) */
body[data-theme="glass"]{
  --bg:#0B0E13;
  /* fallback solid */
  --elev: rgba(20,25,35,.88);
  --text:#E7EAF0; --muted:#B5BAC6;
  --border: color-mix(in oklab,#E7EAF0 40%, transparent);
}
@supports (color: color-mix(in oklab, black, white)){
  body[data-theme="glass"]{ --elev: color-mix(in oklab, #141923 88%, transparent); }
}

/* apply tokens */
body{
  background:var(--bg); color:var(--text);
  font:400 var(--fz-base)/var(--lh-base) system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;
  -webkit-text-size-adjust:100%; text-rendering:optimizeLegibility; font-kerning:normal;
}

/* ---------- Layout kerangka ---------- */
#shell{display:flex;gap:var(--sp-4);align-items:flex-start}
.sidebar{
  width:var(--left-w);
  background:var(--elev);
  border:1px solid var(--border);
  border-radius:12px;
  display:flex;flex-direction:column;min-height:0;
}
#sidebarRight{width:var(--right-w)}
.center{min-width:0;flex:1}
.center-wrap{
  width:min(100%,var(--center-max)); max-width:100%;
  margin-inline:auto; min-width:0;
  padding-inline:var(--center-pad);
  padding-top:var(--sp-4);
  padding-bottom:calc(var(--chatbar-h) + 16px);
}
.sb-top,.sb-mid,.sb-bottom{padding:var(--sp-4)}
.sb-mid{flex:1 1 auto;min-height:0;overflow:auto}
.sb-bottom{position:sticky;bottom:0;background:var(--elev);border-top:1px solid var(--border)}

/* Mobile ≤599px: stack */
@media (max-width:599px){
  #shell{flex-direction:column}
  .sidebar{width:auto}
  .iconbtn span,.btn span{display:none}
}

/* Medium 600–1023px: 2 kolom (Left + Center), Right full-width di bawah */
@media (min-width:600px) and (max-width:1023px){
  #shell{
    display:grid;
    grid-template-columns: var(--left-w) 1fr;
    grid-template-areas:
      "left center"
      "right right";
    gap: var(--sp-4);
  }
  #sidebarLeft{grid-area:left}
  #centerbar{grid-area:center}
  #sidebarRight{grid-area:right; width:auto}
}

/* Desktop ≥1024px: 3 kolom */
@media (min-width:1024px){
  #shell{
    display:grid;
    grid-template-columns: var(--left-w) minmax(0,1fr) var(--right-w);
    gap: var(--sp-4);
  }
}

/* ---------- Komponen umum ---------- */
.eyebrow{font-size:.92em;font-weight:700;margin:var(--sp-3) 0 var(--sp-2);color:var(--muted);letter-spacing:.02em;text-transform:uppercase}
.muted{color:var(--muted)}
.iconbtn,.btn,.tile,.page-item{
  display:inline-flex;align-items:center;gap:8px;cursor:pointer;
  padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:var(--elev);
  min-height:44px;min-width:44px;
}
.iconbtn svg{flex:0 0 18px;display:block}
a:hover,.iconbtn:hover,.page-item:hover,.btn:hover{color:#D81B60;border-color:color-mix(in oklab,#D81B60 40%, var(--border))}
.card,.bubble,.postcard,.readercard,.similarcard,.chatbar,.dock{
  background:var(--elev); border:1px solid var(--border); border-radius:12px;
}
.tile{justify-content:center}

/* Glass hanya untuk panel konten (bukan sidebar) */
body[data-theme="glass"] .card,
body[data-theme="glass"] .bubble,
body[data-theme="glass"] .postcard,
body[data-theme="glass"] .readercard,
body[data-theme="glass"] .chatbar,
body[data-theme="glass"] .dock{
  -webkit-backdrop-filter: blur(12px) saturate(1.05);
  backdrop-filter: blur(12px) saturate(1.05);
  background: color-mix(in oklab, var(--elev) 100%, transparent);
  border-color: color-mix(in oklab, var(--text) 30%, transparent);
}
body[data-theme="glass"] .sidebar{
  -webkit-backdrop-filter:none!important; backdrop-filter:none!important;
  background:var(--bg); border-color:var(--border);
}
@supports not ((-webkit-backdrop-filter: blur(0)) or (backdrop-filter: blur(0))){
  body[data-theme="glass"] .card,
  body[data-theme="glass"] .bubble,
  body[data-theme="glass"] .postcard,
  body[data-theme="glass"] .readercard,
  body[data-theme="glass"] .chatbar,
  body[data-theme="glass"] .dock{ background:var(--elev); }
}

/* Label 2-level */
.label-list{display:grid;gap:var(--sp-2)}
.label-item{border:1px solid var(--border);border-radius:10px;background:var(--elev);overflow:hidden}
.label-item summary{
  display:grid;grid-template-columns:auto 1fr auto auto;align-items:center;gap:var(--sp-2);
  padding:8px 10px;list-style:none;cursor:pointer;user-select:none
}
.label-item summary::-webkit-details-marker{display:none}
.label-item .label-name{font-weight:700}
.label-item .count{color:var(--muted);font-size:.92em}
.label-item .chev{opacity:.8;margin-left:var(--sp-2);transition:transform .2s ease}
.label-item[open] .chev{transform:rotate(180deg)}
.label-item[open] summary{box-shadow:0 0 0 2px color-mix(in oklab,#D81B60,transparent 80%) inset;border-radius:10px}
.label-item .acc{display:grid;gap:var(--sp-2);padding:var(--sp-2);border-top:1px solid var(--border)}
.label-item .acc li{list-style:none}
.label-item .acc .page-item{width:100%;text-align:left;display:grid;grid-template-columns:auto 1fr;gap:var(--sp-2)}

/* Feed/Postcard */
.feed{display:grid;gap:var(--sp-4)}
.postcard{padding:var(--sp-4)}
.postcard .thumb{border:1px solid var(--border);border-radius:10px;overflow:hidden;margin:var(--sp-2) 0}
.postcard .meta{display:flex;gap:var(--sp-3);flex-wrap:wrap;color:var(--muted);font-size:.92em}
.postcard .actions{display:flex;gap:var(--sp-2);flex-wrap:wrap;margin-top:var(--sp-2)}
.postcard h3{margin:0 0 var(--sp-2);overflow-wrap:anywhere}

/* Reader + Similar */
.readercard{padding:var(--sp-4)}
.readercard header{margin-bottom:var(--sp-2)}
.readercard h2{margin:.2em 0 .5em;overflow-wrap:anywhere}
.readercard .meta{display:flex;gap:var(--sp-3);flex-wrap:wrap;color:var(--muted);font-size:.92em}
.readercard .body{overflow-wrap:anywhere}
.readercard .body p{margin:.75em 0}
.readercard .actions{display:flex;gap:var(--sp-2);flex-wrap:wrap;margin-top:var(--sp-3);padding-top:var(--sp-2);border-top:1px solid var(--border)}
.similar{margin-top:var(--sp-4)}
.similar .similarcard{padding:var(--sp-3);margin:var(--sp-2) 0}

/* Bubble chat */
.bubble{display:inline-block;padding:12px 14px;max-width:min(85%,65ch);box-shadow:0 1px 0 rgba(0,0,0,.06)}
.bubble[data-role="system"]{margin-right:auto}
.bubble[data-role="user"]{margin-left:auto;background:color-mix(in oklab,#27AE60, var(--elev) 90%)}

/* Chatbar */
.chatbar{padding:var(--sp-3);margin:var(--sp-3) 0}
.chat-form{display:flex;gap:var(--sp-2)}
.chat-form input{flex:1;border:1px solid var(--border);border-radius:10px;background:var(--elev);padding:10px}

/* SmartScroll */
#smartScroll{position:sticky;bottom:calc(var(--chatbar-h) + 12px);margin-left:auto}
#smartScroll[hidden]{display:none}

/* Callout */
.callout{border-radius:16px;padding:12px 16px;max-width:72ch}
.callout.info   {background:color-mix(in oklab,#2F80ED 10%, transparent); border:1px solid color-mix(in oklab,#2F80ED 40%, transparent)}
.callout.success{background:color-mix(in oklab,#27AE60 10%, transparent); border:1px solid color-mix(in oklab,#27AE60 40%, transparent)}
.callout.warn   {background:color-mix(in oklab,#E2B93B 10%, transparent); border:1px solid color-mix(in oklab,#E2B93B 40%, transparent)}
.callout.error  {background:color-mix(in oklab,#E53935 10%, transparent); border:1px solid color-mix(in oklab,#E53935 40%, transparent)}
.callout :where(h1,h2,h3,h4,h5,h6,p,li,code){color:var(--text)}

/* Aspect-ratio utilities (Anti-CLS) */
.ar-1-1{aspect-ratio:1/1}
.ar-4-5{aspect-ratio:4/5}
.ar-16-9{aspect-ratio:16/9}
.ar-9-16{aspect-ratio:9/16}
.ar-3-4{aspect-ratio:3/4}
.media{object-fit:cover}
.readercard .media{object-fit:contain}

/* Scrollbar tipis */
*{scrollbar-width:thin; scrollbar-color: color-mix(in oklab,var(--text) 40%, transparent) transparent}
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-thumb{background-color:color-mix(in oklab,var(--text) 40%, transparent);border-radius:8px}
@media (hover:hover){ ::-webkit-scrollbar-thumb:hover{background-color:color-mix(in oklab,var(--text) 60%, transparent)} }

/* Paint skipping untuk item stream */
@supports (content-visibility:auto){
  #roomchat > *{content-visibility:auto;contain-intrinsic-size:auto 560px}
}
