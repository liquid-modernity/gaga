/* ====== TOKENS ====== */
:root{
  --bg:#0B0E13; --fg:#EAEAF2; --muted:#B9B9C6; --ink:#0B0E13;
  --card:#141823; --card-2:#0F1320; --line:#262C3A;
  --accent:#FF2BBF; --accent-2:#A50087; --ok:#2ec27e; --warn:#f6c343; --bad:#ff6b6b;
  --bub-user:#A0008A; --bub-sys:#121726;
  --fs:14.5px; --lh:1.625; --radius:16px; --pad:12px;
  --sidew:340px; --centerw:780px; --barh:72px;
  --ico:20px; --shadow:0 8px 28px rgba(0,0,0,.35);
}
@media (max-width:480px){ :root{ --sidew:86vw } }

/* ====== BASE ====== */
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);
  font:400 var(--fs)/var(--lh) system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  -webkit-text-size-adjust:100%}
a{color:#ff6bff;text-decoration:none}
a:hover{color:var(--accent)}
img,video{max-width:100%;height:auto}
button{font:inherit;color:inherit;background:none;border:0;cursor:pointer}
:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
.skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
.skip-link:focus{left:12px;top:8px;width:auto;height:auto;padding:8px 10px;background:#111;border-radius:10px}

/* ====== LAYOUT ====== */
.layout{display:grid;grid-template-columns:1fr;min-height:100dvh}
.center{display:block}
.center-wrap{max-width:var(--centerw);margin:0 auto;padding:14px 12px 120px}

/* Desktop push layout + focus trap overlay */
.sidebar{position:fixed;top:0;bottom:0;width:var(--sidew);background:#0E1220;border-right:1px solid var(--line);
  z-index:70;transform:translateX(-100%);transition:transform .18s ease}
.sidebar.is-right{right:0;left:auto;border-right:0;border-left:1px solid var(--line);transform:translateX(100%)}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.46);backdrop-filter:saturate(120%) blur(2px);z-index:60;display:none}
body.left-open .overlay,body.right-open .overlay{display:block}
body.left-open #sidebarLeft{transform:translateX(0)}
body.right-open #sidebarRight{transform:translateX(0)}
@media(min-width:960px){
  body.left-open .centerbar-empty, body.right-open .centerbar-empty{display:block}
  body.left-open #centerbar, body.right-open #centerbar{visibility:hidden}
}

/* SidebarLeft parts */
#sidebarLeft{color:var(--fg)}
.sb-top{padding:12px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#0E1220;z-index:2}
.profile-card{display:flex;gap:12px;align-items:center}
.profile-card .avatar{border-radius:999px;border:1px solid var(--line)}
.eyebrow{margin:0 0 6px;color:#93a0b5;font-size:12px;letter-spacing:.04em;text-transform:uppercase}
.sb-mid{padding:10px 12px;overflow:auto;height:calc(100dvh - 220px)}
.sb-bottom{padding:8px 0;border-top:1px solid var(--line);position:sticky;bottom:0;background:#0E1220}
.socials a{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:10px;background:#151b2a;border:1px solid var(--line);color:#dfe3f1;margin:0 4px}
.socials a:hover{background:var(--accent);color:white}

/* Label tree (1 ikon + chevron implicit via rotate) */
.label-list{list-style:none;margin:0;padding:0}
.label-list .tree{margin:6px 0;border-radius:12px}
.tree-toggle{display:flex;gap:8px;align-items:center;width:100%;padding:10px;border-radius:12px;min-height:44px;
  background:transparent;color:inherit;border:1px solid transparent}
.tree-toggle:hover{background:#141A2B}
.tree-toggle .ico{width:18px;height:18px;opacity:.9}
.tree-name{flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tree-posts{list-style:none;margin:4px 0 10px 26px;padding:0}
[aria-expanded="false"] + .tree-posts{display:none}
.tree-posts a{display:flex;align-items:center;gap:8px;padding:6px;border-radius:10px;min-height:36px}
.tree-posts a:hover{background:#141A2B}

/* Pages list */
.page-list{list-style:none;margin:0;padding:0}
.page-list a{display:flex;gap:8px;align-items:center;padding:6px;border-radius:10px;min-height:36px}
.page-list a:hover{background:#141A2B}

/* ====== STREAM ====== */
#roomchat{min-height:40vh}
.bubble{position:relative;display:block;max-width:92%;margin:10px 0;padding:12px 14px;border-radius:14px}
.bubble.system{background:var(--bub-sys)}
.bubble.user{margin-left:auto;background:var(--bub-user);color:#fff}
.bubble.system::after{ /* tail siku 90° */
  content:"";position:absolute;left:8px;bottom:-6px;width:10px;height:10px;background:var(--bub-sys);
  box-shadow:1px 1px 0 0 rgba(0,0,0,.15);transform:skewY(0) rotate(45deg)
}
.bubble.user::after{content:"";position:absolute;right:8px;bottom:-6px;width:10px;height:10px;background:var(--bub-user);
  box-shadow:-1px 1px 0 0 rgba(0,0,0,.15);transform:rotate(45deg)
}

/* Postcard & Readercard */
.postcard{background:var(--card);border-radius:16px;border:1px solid var(--line);padding:10px}
.postcard .pc{display:grid;grid-template-columns:92px 1fr;gap:12px;align-items:start}
.pc-thumb{width:92px;height:92px;border-radius:12px;overflow:hidden;background:#0c101b;border:1px solid var(--line)}
.pc-thumb img{display:block;width:100%;height:100%;object-fit:cover}
.pc-title{margin:0 0 4px;font-weight:700}
.pc-meta{font-size:12px;color:#9fb0c9}
.pc-summary{color:#dbe2f5}
.pc-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px;flex-wrap:wrap}
.btn-min{display:inline-flex;align-items:center;gap:6px;background:var(--accent-2);color:#fff;border-radius:10px;
  padding:7px 10px}
.btn-min:hover{background:var(--accent)}
.readercard{background:var(--card-2);border:1px solid var(--line);border-radius:16px;padding:14px}
.readercard h3{margin:0 0 6px}

/* Chatbar */
.chatbar{position:fixed;left:0;right:0;bottom:0;background:#0E1220;border-top:1px solid var(--line);
  padding:9px 12px calc(10px + env(safe-area-inset-bottom,0px));z-index:50}
.chat-form{display:grid;grid-template-columns:auto 1fr repeat(6,auto);gap:8px;align-items:center;max-width:var(--centerw);margin:0 auto}
.chip{display:inline-flex;align-items:center;justify-content:center;min-width:44px;min-height:44px;border-radius:14px;background:#151b2a;border:1px solid var(--line);color:#dfe3f1}
.chip:hover{border-color:var(--accent);color:#fff}
.input-el{background:#0f1423;border:1px solid var(--line);border-radius:14px;padding:11px 12px;color:#fff}
.chat-note{margin:6px auto 0;max-width:var(--centerw);text-align:center;font-size:12px;color:#aab4c8}

/* SmartScroll */
.smartscroll{position:fixed;right:12px;bottom:calc(var(--barh) + 14px);z-index:55;display:flex;gap:6px;align-items:center;
  padding:8px 10px;border-radius:12px;background:#151b2a;border:1px solid var(--line);color:#fff}
.smartscroll[hidden]{display:none}
@media(max-width:480px){ .smartscroll{left:50%;right:auto;transform:translateX(-50%)} }

/* Icon-only chips on very small screens */
@media(max-width:360px){ .iconbtn span{display:none} }

/* Compact postcard for ≤480px */
@media(max-width:480px){
  .postcard .pc{grid-template-columns:64px 1fr}
  .pc-thumb{width:64px;height:64px}
  .pc-title{font-size:14.5px;line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  .pc-summary{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  .postcard .pc-actions{position:absolute;top:8px;right:8px}
  .postcard .pc-actions .btn-min{padding:8px;border-radius:10px;font-size:0}
}

/* Glass + video bg */
#bg{position:fixed;inset:0;z-index:-1}
#bgVideo{display:none}
body[data-theme="glass"][data-bg="video"] #bgVideo{display:block;object-fit:cover;width:100%;height:100%}

/* Perf & CLS guards */
img[loading="lazy"]{content-visibility:auto}
:where(.postcard,.readercard){contain:layout paint}
